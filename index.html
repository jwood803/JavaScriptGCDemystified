<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>JavaScript Garbage Collector Demystified</title>

	<meta name="description" content="Introduction to the JavaScript garbage collector.">
	<meta name="author" content="Jonathan Wood">

	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<link rel="stylesheet" href="css/reveal.min.css">
	<link rel="stylesheet" href="css/theme/night.css" id="theme">

	<!-- For syntax highlighting -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>JavaScript Garbage Collector Demystified</h1>
					<p>
						<small>Created by Jonathan Wood</br>
							jwood@wintellect.com / <a href="http://dotnetmeditations.com">dotnetmeditations.com</a> / <a href="http://twitter.com/jwood">@JWood</a></small>
						</p>

						<aside class="notes">
				        	Go over what the talk will be about - Introduction to the JavaScript garbage collector with emphasis on the V8 engine and some tools and techniques on how to find and solve memory issues in your web application.
				    	</aside>
					</section>

					<section id="intro">
						<h2>Who is this guy?</h2>
						<img src="img/screenshots/whoIsWintellect.jpg">

						<aside class="notes">
							Mention about the company and how notable the founders are. Can also tell the story on taking the performance class that got me into learning more on performance.
						</aside>
					</section>

					<section id="agenda">
						<h2>Agenda</h2>
						<ul>
							<li>Why should you care?</li>
							<li>Garbage Collector algorithms</li>
							<li>Dev Tools Overview</li>
							<li>Demo</li>
						</ul>

						<aside class="notes">
							Briefly go over the agenda to let everyone know what will be covered.
						</aside>
					</section>

					<section>
						<section id="fragments">
							<h2>Biggest performance problems in .NET?</h2>
							<ol>
								<li class="fragment">Memory</li>
								<li class="fragment">...memory</li>
								<li class="fragment">...and more memory</li>
							</ol>
						</section>

						<aside class="notes">
							Relate to the importance of performance implications in .NET. The same thing is happening in JavaScript.
						</aside>
					</section>

					<section id="whyMatter">
						<section class="fragment" id="deadJim">
							<h2>Why does this matter with JavaScript?</h2>
							<img class="fragment" src="img/screenshots/hesdead.png">
						</section>

						<aside class="notes">
							Mention to how much JavaScript is being much more widely used and that functionality is getting put more on the client than on the server. Mention SPAs as well and say that with these, page refreshes are becoming much less frequent so items stay in memory much longer. Also, users can leave up pages going for days which leaves items in memory.
						</aside>
					</section>

					<section id="javascriptMemory">
						<h2>How does memory work in JavaScript?</h2>

						<aside class="notes">
							This is for the regular mark and sweep algorithm. Introduce the object graph, as well, in which all JavaScript values are part of the object graph.
						</aside>
					</section>

					<section id="primitiveTypes">
						<section class="fragment" id="primTypes">
							<h2>Primitive Types</h2>

							<aside class="notes">
								Down arrow here!
							</aside>
						</section>
						<section class="fragment" id="numTypes">
							<p>Numbers</p>
							<pre><code data-trim contenteditable>
var num = 12;

var num2 = 2.35;
							</code></pre>
						</section>
						<section class="fragment" id="numTypes">
							<p>Strings</p>
							<pre><code data-trim contenteditable>
var hello = "Hello, Carolina Code Camp!";

var sub = num.substr(0, 3);
							</code></pre>
						</section>
						<section class="fragment" id="numTypes">
							<p>Booleans</p>
							<pre><code data-trim contenteditable>
var isTruthy = true;

isTruthy = false; // Oh, noes!
							</code></pre>
						</section>

						<aside class="notes">
							These primitive types cannot reference any other values. The only container type is the Object.

							An Array in JavaScript is actually an Object that has numeric keys.
						</aside>
					</section>

					<section id="duringGC">
						<h2>What happens during a GC in JavaScript?</h2>

						<aside class="notes">
							The browser is what decides when to do a GC
						</aside>
					</section>

					<section id="objectGraph">
						<h2>JavaScript Object Graph</h2>
						<img src="img/diagrams/JavaScript Object Graph.jpg">

						<aside class="notes">
							Graph is showing objects related to the root node. Objects can reference other objects.
						</aside>
					</section>

					<section id="beforeGC">
						<h2>Before a GC</h2>
						<img src="img/diagrams/JavaScript Object Graph Before GC.jpg">

						<aside class="notes">
							To one object, the reference to the root node is gone. During the GC, this will get marked to remove from memory.
						</aside>
					</section>

					<section id="afterGC">
						<h2>After a GC</h2>
						<img src="img/diagrams/JavaScript Object Graph After GC.jpg">

						<aside class="notes">
							GC was completed and the marked objects were cleared from memory allowing new values to be allocated to the heap.
						</aside>
					</section>

					<section id="v8Engine">
						<section id="generations">
							<h2>V8 Engine Specifics</h2>
							<ul>
								<li class="fragment">Generational</li>
								<ul class="fragment">
									<li>Young</li>
									<li>Old</li>
								</ul>
							</ul>
						</section>

						<aside class="notes">
							Relate this back to .NET with the generational algorithm it has.
						</aside>
					</section>

					<section id="youngGen">
						<section class="fragment" id="youngGenIntro">
							<h2>Young Generation</h2>
							<ul>
								<li class="fragment">Split into two spaces - to and from</li>
							</ul>

							<aside class="notes">
								Down arrow here!
							</aside>
						</section>

						<section class="fragment" id="toAndFrom">
							<img src="img/diagrams/Young Gen/1-toAndFrom.jpg">

							<aside class="notes">
								Young Gen is broken up into two spaces - To and From. The To space is where new objects are allocated. The From
								space is only used during a GC to sweep the objects.
							</aside>
						</section>

						<section class="fragment" id="beforeYoungGC">
							<img src="img/diagrams/Young Gen/2-beforeGC.jpg">

							<aside class="notes">
								Items are being allocated.
							</aside>
						</section>

						<section class="fragment" id="GCTriggered">
							<img src="img/diagrams/Young Gen/3-GCTriggered.jpg">

							<aside class="notes">
								When trying to allocate "E", there's not enough room on the heap. This triggers a GC and the page is now paused.
							</aside>
						</section>

						<section class="fragment" id="swapToFromSpace">
							<img src="img/diagrams/Young Gen/4-swapToFromSpace.jpg">

							<aside class="notes">
								The objects in the To space are swapped to the Frome space.
							</aside>
						</section>

						<section class="fragment" id="fromSpaceSweep">
							<img src="img/diagrams/Young Gen/5-fromSpaceSweep.jpg">

							<aside class="notes">
								Objects are swept to see if they have any references to the root node.
							</aside>
						</section>

						<section class="fragment" id="afterSweeping">
							<img src="img/diagrams/Young Gen/6-afterSweeping.jpg">

							<aside class="notes">
								After sweeping, "B" was found to not have a reference to the root node.
							</aside>
						</section>

						<section class="fragment" id="afterYoungGC">
							<img src="img/diagrams/Young Gen/7-afterGC.jpg">

							<aside class="notes">
								All live objects are copied back to the To space or promoted to the Old gen. The page is now resumed.
							</aside>
						</section>
					</section>

					<section id="oldGen">
						<h2>Old Generation</h2>
						<ul>
							<li class="fragment"><strong>Infrequently</strong> collected</li>
						</ul>

						<aside class="notes">
							After a value is sufficiently old (how many young gen collections it survives) it is tenured into the old generation.

							Infrequent since most objects (around 70% to 90% don't survive a young gen).
						</aside>
					</section>

					<section id="findIssues">
						<section id="findFragments">
							<h2>How do I know I have memory issues?</h2>
							<ul>
								<li class="fragment">Users</li>
								<li class="fragment">Crashes</li>
								<li class="fragment">Collecting data</li>
							</ul>
						</section>
					</section>

					<section id="collectData">
						<h2>How to collect memory data?</h2>
						<img src="img/screenshots/performance.memoryScreenshot.png">
						<ul>
							<li>jsHeapSizeLimit - Memory the JavaScript heap is limited to</li>
							<li>usedJSHeapSize - Memory currently being used</li>
							<li>totalJSHeapSize - Memory that has been allocated on the JavaScript heap (includes free space)</li>
						</ul>

						<aside class="notes">
							Mention the caveat Chrome has that, even though each tab is a separate process, it can spawn a finite number of processes.
							So if there are a lot of tabs open, multiple tabs can share a process. If that's the case, the memory of the other tabs will
							be represented by the API call.
						</aside>
					</section>

					<section id="toolsAndTechniques">
						<h2>Chrome tools and techniques</h2>
					</section>

					<section id="devTools">
						<img src="img/screenshots/devTools.jpg">

						<aside class="notes">
							How to get to the Dev Tools.
						</aside>
					</section>

					<section id="timeline">
						Screenshot of timeline here

						<aside class="notes">
							Shows that there is a memory problem, but only the heap profiler can help identify where it is.
						</aside>
					</section>

					<section id="heapProfiler">
						Screenshot of the profiler here

						<aside class="notes">
							Blue bars indicate objects that are still live at the end of the timeline, gray bars indicate objects that were allocated during
							the timeline, but have since been garbage collected.


						</aside>
					</section>

					<section id="demo">
						<h2><a href="js/Demo/index.html">Demo</a> time!</h2>
					</section>

					<section id="dangerousOutThere">
						<img src="img/screenshots/itsDangerous.jpg">

						<aside class="notes">
							JavaScript can be dangerous if it's abused too much!
						</aside>
					</section>

					<section id="takeAways">
						<ul>
							<li class="fragment">How much memory is the page using?</li>
							<li class="fragment">Is the page GCing too frequently?</li>
						</ul>

						<aside class="notes">
							1. Using more memory can be detrimental to the page's performance since it will cause more frequent GCs which will cause the page
							a lot of pauses to the page to perform the collections.
							2. This can be found out by using the timeline tool.
						</aside>
					</section>

<!-- 					<section id="relatedInfo">
						<h2>Related Info</h2>
						<p>
							<a class="image" href="http://www.wintellectnow.com"><img width="620" height="240" src="img/logos/wintellectnow-logo-620x240.png" alt="WintellectNOW"></a>
						</p>
					</section> -->

					<section id="sources">
						<h2>Sources</h2>
						<ul>
							<li><a href="http://www.html5rocks.com/en/tutorials/memory/effectivemanagement/">Effectively Managing Memory at Gmail Scale</a></li>
							<li><a href="http://coding.smashingmagazine.com/2012/11/05/writing-fast-memory-efficient-javascript/">Writing Fast Memory Efficient JavaScript</a></li>
						</ul>
					</section>

					<section id="contact">
						<h2>Thank you!</h2>
						<p>Email: jwood@wintellect.com</br>
							Blog: <a href="http://dotnetmeditations.com">dotnetmeditations.com</a> / <a href="http://www.wintellect.com/blogs/jwood">Wintellect</a></br>
							Twitter: <a href="http://twitter.com/jwood">@JWood</a></br>
						</p>
						<small>Presentation can be found on <a href="https://github.com/jwood803/JavaScriptGCDemystified">GitHub</a><br>
							Demo code can be found at <a href="http://goo.gl/uI4D4">http://goo.gl/uI4D4</a>
						</small>
					</section>
				</div>
			</div>

			<script src="lib/js/head.min.js"></script>
			<script src="js/reveal.min.js"></script>

			<script>
				Reveal.initialize({
					controls: true,
					progress: true,
					history: true,
					center: true,

					theme: Reveal.getQueryHash().theme,
					transition: Reveal.getQueryHash().transition || 'default',

				// Optional libraries used to extend on reveal.js
				dependencies: [
				{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
				{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
				{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
				{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});
			</script>
		</body>
		</html>